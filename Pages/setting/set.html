<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings Page</title>
    <link rel="stylesheet" href="set.css">
</head>
<body>
    <h1>Settings</h1>
    <label for="colorPicker">Choose a background color:</label>
    <input type="color" id="colorPicker" value="#ffffff">

    <label for="colorPicker">Choose a Text color:</label>
    <input type="color" id="colorText" value="#ffffff">
   
    <label for="fontSize">Font Size:</label>
    <input type="number" id="fontSize" value="16">

    <label for="fontStyle">Font Style:</label>
    <select id="fontStyle">
        <option value="normal">Normal</option>
        <option value="italic">Italic</option>
        <option value="oblique">Oblique</option>
    </select>

    <label for="language">Language:</label>
    <select id="language">
        <option value="en">English</option>
        <option value="fr">French</option>
        <option value="es">Spanish</option>
    </select>
   
    <button id="saveSettings">Save Settings</button>
    <a href="../Project/projects.html">kdk</a>
    
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
        import { getAuth, onAuthStateChanged} from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";
        import { getDatabase, set, ref, update, push, onValue } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAzKdpBJmYURQeOdkttrdGHSkonN1QjDr0",
            authDomain: "hci-project-54354.firebaseapp.com",
            projectId: "hci-project-54354",
            storageBucket: "hci-project-54354.appspot.com",
            messagingSenderId: "970506049036",
            appId: "1:970506049036:web:eec9f3bab77473b1e08029"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth();
        function changeLanguage(lang) {
            document.documentElement.lang = lang;
        }
        function applySavedSettings(color, textColor, fontSize, fontStyle) {
            document.getElementById('colorPicker').value = color;
            document.getElementById('colorText').value = textColor;
            document.getElementById('fontSize').value = fontSize;
            document.getElementById('fontStyle').value = fontStyle;

            document.body.style.backgroundColor = color;
            document.body.style.color = textColor;
            document.body.style.fontSize = fontSize + 'px';
            document.body.style.fontStyle = fontStyle;
        }

        let colorFetched = false; // Flag to prevent multiple fetches

        function fetchAndApplySavedSettings() {
            const user = auth.currentUser;
            if (user && !colorFetched) {
                const uid = user.uid;
                const settingsRef = ref(database, 'settings/' + uid);
                onValue(settingsRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data && data.color) {
                        applySavedSettings(data.color, data.textColor, data.fontSize, data.fontStyle);
                        colorFetched = true;
                    }
                });
            }
        }
        onAuthStateChanged(auth, (user) => {
            if (user) {
                fetchAndApplySavedSettings();
            }
        });
        fetchAndApplySavedSettings();
        document.getElementById('saveSettings').addEventListener('click', function() {
            const color = document.getElementById('colorPicker').value;
            const textColor = document.getElementById('colorText').value;
            const fontSize = document.getElementById('fontSize').value;
            const fontStyle = document.getElementById('fontStyle').value;
            saveSettingsToFirebase(color, textColor, fontSize, fontStyle);
        });

        document.getElementById('colorPicker').addEventListener('input', function() {
            document.body.style.backgroundColor = this.value;
        });
        document.getElementById('colorText').addEventListener('input', function() {
            document.body.style.color= this.value;
        });
        document.getElementById('fontSize').addEventListener('input', function() {
            document.body.style.fontSize= this.value;
        });
        document.getElementById('fontStyle').addEventListener('input', function() {
            document.body.style.fontStyle= this.value;
        });
        document.getElementById('language').addEventListener('change', function() {
            changeLanguage(this.value);
        });
        function saveSettingsToFirebase(color, tcolor, fontSize, fontStyle) {
            const user = auth.currentUser;
            if (user) {
                const uid = user.uid;
                set(ref(database, 'settings/' + uid), {
                    color: color,
                    textColor:tcolor,
                    fontSize: parseInt(fontSize), // Ensure fontSize is saved as an integer
                    fontStyle: fontStyle
                })
                .then(() => {
                    console.log("Background color saved successfully.");
                })
                .catch((error) => {
                    console.error("Error saving background color: ", error);
                });
            } else {
                console.error("No user is currently signed in.");
            }
        }
    </script>
</body>
</html>
