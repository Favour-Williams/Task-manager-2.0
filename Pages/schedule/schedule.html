<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <link rel="stylesheet" href="schedule.css" />
</head>
<body>
   <section>
        <header class="dark-theme">
            <li id="foricon"><a href="#"><em>GetItDone</em></a></li>
            <div class="left-section">
                
            <input type="text" placeholder="Search" id="searchInput">
            </div>
            <div class="right-section">
                <div class="icon settings"><i class="fas fa-cog"></i></div>
                <div id="noti" class="icon notifications" >
                    <a href="../notification/n.html"><i class="fas fa-bell"></i></a>
                    <span class="notification-dot">4</span>
                </div>
                <div class="icon profile"><a href="../profile/p.html"><i class="fas fa-user"></i></a></div>
            </div>
        </header>
   </section>

   <section>
        <nav class="navbar">
            <ul class="nav-links">
                <li><a href="../Dashboard/dashboard.html"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="../board/board.html"><i class="fas fa-clipboard-list"></i> Board</a></li>
                <li><a href="../Project/projects.html"><i class="fas fa-project-diagram"></i> Projects</a></li>
                <li><a href="../task/taskList.html"><i class="fas fa-tasks"></i> Task List</a></li>
                <li><a href="../schedule/schedule.html"><i class="fas fa-calendar-alt"></i> Calender</a></li>
                <li><a href="../chat/chat.html"><i class="fas fa-comments"></i> Chat</a></li>
                <li><a href="../sign-in/Sign_In.html"><i class="fas fa-sign-out-alt"></i> Log Out</a></li>
            </ul>
            
        </nav>
   </section>

    <article>
        <h1>Schedule</h1>
    <!-- Main wrapper for the calendar application -->
    <div class="wrapper">
        <div class="container-calendar">
            <div id="left" style="display: none;">
                <div id="event-section">
                    <h3>Add Event</h3>
                    <input type="date" id="eventDate">
                    <input type="text"
                        id="eventTitle"
                        placeholder="Event Title">
                    <input type="text"
                        id="eventDescription"
                        placeholder="Event Description">
                    <button id="addEvent" onclick="addEvent()">
                        Add
                    </button>
                </div>
            </div>
            <div id="reminder-section">
                <h3>Reminders</h3>
                <!-- List to display reminders -->
                <ul id="reminderList">
                    <li data-event-id="1">
                        <strong>Event Title</strong>
                        - Event Description on Event Date
                        <button class="delete-event"
                            onclick="deleteEvent(1)">
                            Delete
                        </button>
                    </li>
                </ul>
            </div>
            <div id="right">
                <h3 id="monthAndYear"></h3>
                <div class="button-container-calendar">
                    <button id="previous"
                            onclick="previous()">
                          ‹
                      </button>
                    <button id="next"
                            onclick="next()">
                          ›
                      </button>
                </div>
                <table class="table-calendar"
                       id="calendar"
                       data-lang="en">
                    <thead id="thead-month"></thead>
                    <!-- Table body for displaying the calendar -->
                    <tbody id="calendar-body"></tbody>
                </table>
                <div class="footer-container-calendar">
                    <label for="month">Jump To: </label>
                    <!-- Dropdowns to select a specific month and year -->
                    <select id="month" onchange="jump()">
                        <option value=0>Jan</option>
                        <option value=1>Feb</option>
                        <option value=2>Mar</option>
                        <option value=3>Apr</option>
                        <option value=4>May</option>
                        <option value=5>Jun</option>
                        <option value=6>Jul</option>
                        <option value=7>Aug</option>
                        <option value=8>Sep</option>
                        <option value=9>Oct</option>
                        <option value=10>Nov</option>
                        <option value=11>Dec</option>
                    </select>
                    <!-- Dropdown to select a specific year -->
                    <select id="year" onchange="jump()"></select>
                </div>
            </div>
            <button  class="buttonAdd" id="toggleButton">add event</button>
        </div>
    </div>
    </article>

    <script src="script.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
        import { getAuth, onAuthStateChanged} from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";
        import { getDatabase, remove, set, ref, update, push, onValue } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-database.js";

            
        const firebaseConfig = {
            apiKey: "AIzaSyAzKdpBJmYURQeOdkttrdGHSkonN1QjDr0",
            authDomain: "hci-project-54354.firebaseapp.com",
            projectId: "hci-project-54354",
            storageBucket: "hci-project-54354.appspot.com",
            messagingSenderId: "970506049036",
            appId: "1:970506049036:web:eec9f3bab77473b1e08029"
        };
            
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth();

        onAuthStateChanged(auth, (user) => {
            if (user) {
                displayEvents(user.uid);
            }
        });

        const addEvent = document.getElementById("addEvent");

        addEvent.addEventListener('click', (e)=>{
            e.preventDefault();
            const eventDate = document.getElementById("eventDate").value;
            const eventTitle = document.getElementById("eventTitle").value;
            const eventDescription = document.getElementById("eventDescription").value;


            onAuthStateChanged(auth, (user)=>{
                if(user){
                    const uid = user.uid;
                    //const userUID = sessionStorage.getItem('userUID');
                    console.log(uid);
                    push(ref(database, 'events/' + uid), {
                        Date:eventDate,
                        eventTitle: eventTitle,
                        eventDescription:eventDescription
                    })
                    .then((snapshot)=>{console.log("ADDED:", snapshot.key);})
                    .catch((error)=>{console.error(error);})

                    document.getElementById("eventDate").value = "";
                    document.getElementById("eventTitle").value = "";
                    document.getElementById("eventDescription").value = "";            
                }
                else{
                    //
                }
            })
        })
        function displayEvents(userId){
            const eventRef = ref(database, 'events/' + userId);
            onValue(eventRef, (snapshot)=>{
                const events = snapshot.val();
                const eventList = document.getElementById("reminderList");
                eventList.innerHTML='';

                for (const eventId in events){
                    const event = events[eventId];
                    addNewEvent(event.Date, event.eventTitle, event.eventDescription, eventId);
                }
            })
        }
        function addNewEvent(date, eventTitle, eventDescription, eventId){
            let eventDate = new Date(date);
            let title = eventTitle;
            let description = eventDescription;

            if (eventDate.getMonth() === currentMonth && eventDate.getFullYear() === currentYear) {
			let listItem = document.createElement("li");
			listItem.innerHTML =
				`<strong>${title}</strong> - 
			${description} on 
			${eventDate.toLocaleDateString()}`;

			// Add a delete button for each reminder item
			let deleteButton = document.createElement("button");
			deleteButton.className = "delete-event";
			deleteButton.textContent = "Delete";
            deleteButton.dataset.eventId = eventId; // Store the event ID

			deleteButton.onclick = deleteEvent
			
            let reminderList = document.getElementById("reminderList");
			listItem.appendChild(deleteButton);
			reminderList.appendChild(listItem);
		}
        }
        //const deleteEvent = document.getElementById("delete-event");
        function deleteEvent(e){
            e.preventDefault();

            onAuthStateChanged(auth, (user) => {
            if (user) {
                const eventId = e.target.dataset.eventId;
                const uid = user.uid;
                const eventRef = ref(database, `events/${uid}/${eventId}`);

                remove(eventRef)
                .then(()=>{
                    console.log("GOOD");
                })
                .catch((error)=>{
                    console.error(error);
                })

            }
        });
        }
    </script>
</body>
</html>